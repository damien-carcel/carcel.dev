version: 2.1

workflows:
    pull_request:
        jobs:
            - tests:
                  context:
                      - docker-hub-credentials
                  filters:
                      branches:
                          ignore:
                              - index

jobs:
    tests:
        docker:
            - image: node:18
        steps:
            - checkout
            - run:
                  name: Create Yarn cache and configuration directories and files
                  command: ./.devcontainer/setup.sh
            - run:
                  name: Install the latest Task binary
                  command: npm install -g @go-task/cli
            - restore_cache:
                  keys:
                      - yarn-{{ .Environment.CACHE_VERSION }}-{{ checksum "yarn.lock" }}
                      - yarn-{{ .Environment.CACHE_VERSION }}-
            - run:
                  name: Install dependencies
                  command: task dependencies:install
            - save_cache:
                  key: yarn-{{ .Environment.CACHE_VERSION }}-{{ checksum "yarn.lock" }}
                  paths:
                      - ~/.cache/yarn
            - run:
                  name: Lint the stylesheets
                  command: task tests:stylelint
            - run:
                  name: Check the code style
                  command: task tests:prettier
            - run:
                  name: Lint the TS code
                  command: task tests:eslint
