version: '3'

tasks:
  database:
    desc: Start the database.
    cmds:
      - docker compose up -d database
    aliases: [db]

  build:
    desc: Build the production artifacts.
    cmds:
      - docker compose run --rm node yarn build
    aliases: [b]

  dev:
    desc: Run the application using the Vite development server.
    cmds:
      - docker compose up -d dev
      - echo ""
      - echo "┌───────────────────────────────────────────────────┐"
      - echo "│                                                   │"
      - echo "│   ◈ Server now ready on http://localhost:3000 ◈   │"
      - echo "│                                                   │"
      - echo "└───────────────────────────────────────────────────┘"
      - echo ""
    aliases: [d]

  prod:
    desc: Preview the production build. Be sure to first run "make install".
    cmds:
      - docker compose up -d prod
      - echo ""
      - echo "┌───────────────────────────────────────────────────┐"
      - echo "│                                                   │"
      - echo "│   ◈ Server now ready on http://localhost:8000 ◈   │"
      - echo "│                                                   │"
      - echo "└───────────────────────────────────────────────────┘"
      - echo ""
    aliases: [p]

  down:
    desc: Stop the application (dev or prod preview alike).
    cmds:
      - docker compose down -v --remove-orphans
    aliases: [dd]
